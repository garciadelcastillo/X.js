/*! X.js v0.1.0 | (c) 2015 Jose Luis Garcia del Castillo */
var is=function(t){if(1!=arguments.length)return console.warn("Ontology.js: invalid arguments for is()"),void 0;var n={"null":"nullObj",undefined:"undefinedObj",nan:"NaNObj","boolean":"boolean",number:"number","function":"function",string:"string",array:"array",object:"object"},r=function(t,n,a,o){if(t===n)return 0!==t||1/t===1/n;if(null==t||null==n)return t===n;var s=toString.call(t);if(s!==toString.call(n))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!==+t?+n!==+n:0===+t?1/+t===1/n:+t===+n;case"[object Date]":case"[object Boolean]":return+t===+n}var i="[object Array]"===s;if(!i){if("object"!=typeof t||"object"!=typeof n)return!1;var u=t.constructor,l=n.constructor;if(u!==l&&!(is(u).function()&&u instanceof u&&is(l).function()&&l instanceof l)&&"constructor"in t&&"constructor"in n)return!1}a=a||[],o=o||[];for(var c=a.length;c--;)if(a[c]===t)return o[c]===n;if(a.push(t),o.push(n),i){if(c=t.length,c!==n.length)return!1;for(;c--;)if(!r(t[c],n[c],a,o))return!1}else{var f,h=e(t);if(c=h.length,e(n).length!==c)return!1;for(;c--;)if(f=h[c],!has(n).property(f)||!r(t[f],n[f],a,o))return!1}return a.pop(),o.pop(),!0},e=function(t){if(!is(t).object())return[];if(Object.keys)return Object.keys(t);var n=[];for(var r in t)has(t).property(r)&&n.push(r);return n},a={};return a.arg=t,a.nullObj=function(){return null===this.arg},a.nul=a.nullObj,a.undefinedObj=function(){return void 0===this.arg},a.undef=a.undefinedObj,a.NaNObj=function(){return this.number()&&this.arg!==+this.arg},a.nan=a.NaNObj,a.boolean=function(){return this.arg===!0||this.arg===!1||"[object Boolean]"===toString.call(this.arg)},a.number=function(){return"[object Number]"===toString.call(this.arg)},a.function=function(){return"[object Function]"===toString.call(this.arg)},a.string=function(){return"[object String]"===toString.call(this.arg)},a.array=function(){return Array.isArray?Array.isArray(this.arg):"[object Array]"===toString.call(this.arg)},a.object=function(){return"[object Object]"===Object.prototype.toString.call(this.arg)},a.primitive=function(){return this.either("boolean","number","string","null","undefined")},a.ofType=function(t){return n[t]?this[n[t]]():(console.warn('Ontology.js: unrecognized data type "'+t+'" for is().ofType()'),!1)},a.type=a.ofType,a.notOfType=function(t){return n[t]?!this[n[t]]():(console.warn('Ontology.js: unrecognized data type "'+t+'" for is().not()'),!0)},a.notType=a.notOfType,a.either=function(){for(var t=arguments,r=t.length,e=0;r>e;e++){if(!n[t[e]])return console.warn('Ontology.js: unrecognized data type "'+t[e]+'" for is().either()'),!1;if(this[n[t[e]]]())return!0}return!1},a.neither=function(){for(var t=arguments,r=t.length,e=0;r>e;e++){if(!n[t[e]])return console.warn('Ontology.js: unrecognized data type "'+t[e]+'" for is().neither()'),!1;if(this[n[t[e]]]())return!1}return!0},a.equalTo=function(t){return this.arg==t},a.equal=a.equalTo,a.notEqualTo=function(t){return this.arg!=t},a.notEqual=a.notEqualTo,a.identicalTo=function(t){return this.arg===t},a.identical=a.identicalTo,a.strictEqualTo=a.identicalTo,a.strictEqual=a.identicalTo,a.notIdenticalTo=function(t){return this.arg!==t},a.notIdentical=a.notIdenticalTo,a.deepIdenticalTo=function(t){return r(this.arg,t)},a.deepIdentical=a.deepIdenticalTo,a},are=function(t){if(1!=arguments.length)return console.warn("Ontology.js: invalid arguments for are()"),void 0;if(!is(t).array())return console.warn("Ontology.js: must pass an Array as argument for are()"),void 0;var n={"null":"nullObjs",undefined:"undefinedObjs",nan:"NaNObjs","boolean":"booleans",number:"numbers","function":"functions",string:"strings",array:"arrays",object:"objects"},r={};r.args=t;var e=t.length;return r.nullObjs=function(){for(var t=0;e>t;t++)if(!is(this.args[t]).nullObj())return!1;return!0},r.nuls=r.nullObjs,r.nulls=r.nullObjs,r.undefinedObjs=function(){for(var t=0;e>t;t++)if(!is(this.args[t]).undefinedObj())return!1;return!0},r.undef=r.undefinedObjs,r.NaNObjs=function(){for(var t=0;e>t;t++)if(!is(this.args[t]).NaNObj())return!1;return!0},r.nans=r.NaNObjs,r.NaNs=r.NaNObjs,r.booleans=function(){for(var t=0;e>t;t++)if(!is(this.args[t]).boolean())return!1;return!0},r.numbers=function(){for(var t=0;e>t;t++)if(!is(this.args[t]).number())return!1;return!0},r.functions=function(){for(var t=0;e>t;t++)if(!is(this.args[t]).function())return!1;return!0},r.strings=function(){for(var t=0;e>t;t++)if(!is(this.args[t]).string())return!1;return!0},r.arrays=function(){for(var t=0;e>t;t++)if(!is(this.args[t]).array())return!1;return!0},r.objects=function(){for(var t=0;e>t;t++)if(!is(this.args[t]).object())return!1;return!0},r.primitives=function(){return this.either("boolean","number","string","null","undefined")},r.ofType=function(t){if(!n[t])return console.warn('Ontology.js: unrecognized data type "'+t+'" for are().ofTypes()'),!1;for(var r=0;e>r;r++)if(!is(this.args[r]).ofType(t))return!1;return!0},r.type=r.ofType,r.notOfType=function(t){if(!n[t])return console.warn('Ontology.js: unrecognized data type "'+t+'" for are().not()'),!0;for(var r=0;e>r;r++)if(is(this.args[r]).ofType(t))return!1;return!0},r.notType=r.notOfType,r.either=function(){for(var t=arguments,r=t.length,a=0;r>a;a++)if(!n[t[a]])return console.warn('Ontology.js: unrecognized data type "'+t[a]+'" for are().either()'),!1;for(var a=0;e>a;a++){for(var o=!1,s=0;r>s;s++)if(is(this.args[a]).ofType(t[s])){o=!0;break}if(!o)return!1}return!0},r.neither=function(){for(var t=arguments,r=t.length,a=0;r>a;a++)if(!n[t[a]])return console.warn('Ontology.js: unrecognized data type "'+t[a]+'" for are().either()'),!1;for(var a=0;e>a;a++){for(var o=!1,s=0;r>s;s++)if(is(this.args[a]).ofType(t[s])){o=!0;break}if(o)return!1}return!0},r.equalTo=function(t){var n=t.length;if(e!=n)return!1;for(var r=0;e>r;r++)if(this.args[r]!=t[r])return!1;return!0},r.equal=r.equalTo,r.notEqualTo=function(t){var n=t.length;if(e!=n)return!0;for(var r=0;e>r;r++)if(this.args[r]==t[r])return!1;return!0},r.notEqual=r.notEqualTo,r.identicalTo=function(t){var n=t.length;if(e!=n)return!1;for(var r=0;e>r;r++)if(this.args[r]!==t[r])return!1;return!0},r.identical=r.identicalTo,r.notIdenticalTo=function(t){var n=t.length;if(e!=n)return!0;for(var r=0;e>r;r++)if(this.args[r]===t[r])return!1;return!0},r.notIdentical=r.notIdenticalTo,r.deepIdenticalTo=function(t){var n=t.length;if(e!=n)return!1;for(var r=0;e>r;r++)if(!is(this.args[r]).deepIdenticalTo(t[r]))return!1;return!0},r.deepIdentical=r.deepIdenticalTo,r},has=function(t){if(1!=arguments.length)return console.warn("Ontology.js: invalid arguments for has()"),void 0;var n={};return n.arg=t,n.property=function(t){return null!=this.arg&&Object.prototype.hasOwnProperty.call(this.arg,t)},n.prop=n.property,n.key=n.property,n},have=function(t){if(1!=arguments.length)return console.warn("Ontology.js: invalid arguments for have()"),void 0;if(!is(t).array())return console.warn("Ontology.js: must pass an Array as argument for have()"),void 0;var n={};n.args=t;var r=t.length;return n.property=function(t){for(var n=0;r>n;n++)if(null==this.args[n]||!Object.prototype.hasOwnProperty.call(this.args[n],t))return!1;return!0},n.prop=n.property,n.key=n.property,n},what=function(t){if(1!=arguments.length)return console.warn("Ontology.js: invalid arguments for what()"),void 0;var n={};n.arg=t;var r={"null":"nullObj",undefined:"undefinedObj",nan:"NaNObj","boolean":"boolean",number:"number","function":"function",string:"string",array:"array",object:"object"};return n.type=function(){for(var t in r)if(is(this.arg).type(t))return t;return console.warn("Ontology.js: object type is not recognized"),!1},n};if("object"!=typeof exports||void 0===exports);else{var ont=module.exports={};ont.is=is,ont.are=are,ont.has=has,ont.have=have}(function(){var t=!1,n=(2*Math.PI,180/Math.PI),r=Math.PI/180,e={},a=[];t&&(e._elements=a);var o=0,s=1;e.setLogLevel=function(t){return 0==arguments.length?s:(s=t,void 0)};var i=function(t){1==t._parents.length&&"XWRAP"==t._parents[0]._type&&(t._isConstrained=!1,t._wrappedSingleParent=!0)},u=function(t,n,r,e){var a=new _[t];if(e)for(var o in e)e.hasOwnProperty(o)&&(a[o]=e[o]);return a._makeChildOfParents(n),a._update=_[t]._updates[r],a._updateParentArrayness(),a._matchUpdate(),a._updateValueType(),a},l=function(t){return what(t).type()},c=function(n){this._id=o++,this._value=n,this._parents=[],this._children=[],this._xvar=!0,this._name="",this._type="XBASE",this._jsType="null",this._isConstrained=!0,this._wrappedSingleParent=!1,this._hasArrayParent=!1,this._parentsLengths=[],this._matchPatternType="longest-list",this._matchPattern=[],this._properties={},a.push(this),this._updateChildren=function(){this._children.forEach(function(n){t&&console.log('DEBUG: updating "'+n._name+'"'),n._updateParentArrayness(),n._matchUpdate(),n._updateValueType(),n._updateChildren()})},this._makeChildOfParents=function(t){for(var n=t.length,r=0;n>r;r++){var e=t[r];e&&e._xvar||(e=g(e)),this._parents.push(e),e._children.push(this)}i(this)},this._matchUpdate=function(){if(this._hasArrayParent){for(var t=[],n=0;this._parents.length>n;n++)t.push(this._parents[n]._value.length);is(t).deepIdentical(this._parentsLengths)||(this._parentsLengths=t,this._updateMatchPattern()),this._value=[];for(var n=0;this._matchPattern.length>n;n++){var r=this._parentSlice(this._matchPattern[n]);this._value.push(this._update(r))}}else{var r=this._parentSlice();this._value=this._update(r)}},this._update=function(){return this._value},this._register=function(t,n){return this._properties[t]=n,n},this._parentSlice=function(t){var n=[];if(t===void 0)for(var r=this._parents.length,e=0;r>e;e++)n.push(this._parents[e]._value);else for(var r=this._parents.length,e=0;r>e;e++)n.push(this._parents[e]._value[t[e]]);return n},this._updateParentArrayness=function(){if(t&&console.log("Updating parent arrayness for "+this._value),!this._hasArrayParent){for(var n=0;this._parents.length>n;n++)if("array"===this._parents[n]._jsType){this._hasArrayParent=!0;break}!this._hasArrayParent}},this._updateValueType=function(){is(this._value).type(this._jsType)||(this._jsType=l(this._value),t&&console.log("Updated _jsType to "+this._jsType+" for "+this._value))},this._updateMatchPattern=function(){function n(t,e){for(var a=u._parents[e]._value.length,o=0;a>o;o++){var s=t.slice(0);s.push(o),e>=r-1?u._matchPattern.push(s):n(s,e+1)}}t&&console.log("Updating matchPattern for "+this._name);var r=this._parents.length;if(this._matchPattern=[],"longest-list"===this._matchPatternType){for(var e=0,a=0;r>a;a++)this._parents[a]._value.length>e&&(e=this._parents[a]._value.length);for(var a=0;e>a;a++){for(var o=[],s=0;r>s;s++)o.push(a>this._parents[s]._value.length-1?this._parents[s]._value.length-1:a);this._matchPattern.push(o)}return!0}if("shortest-list"===this._matchPatternType){for(var i=Number.MAX_VALUE,a=0;r>a;a++)i>this._parents[a]._value.length&&(i=this._parents[a]._value.length);for(var a=0;i>a;a++){for(var o=[],s=0;r>s;s++)o.push(a);this._matchPattern.push(o)}return!0}if("cross-reference"===this._matchPatternType){var u=this;return n([],0),!0}return!1},this._makeOrphan=function(){for(var t=0;this._parents.length>t;t++){for(var n=!1,r=0;this._parents[t]._children.length>r;r++)if(this._parents[t]._children[r]._id==this._id){this._parents[t]._children.splice(r,1),n=!0;break}if(!n)return console.log("Couldnt find this object in parents children, something went wrong "+t),!1}return this._parents=[],!0}};c.prototype={get val(){return this._value},set val(t){this._isConstrained?s&&console.warn("X.js: Sorry, this variable is constrained"):this._wrappedSingleParent?this._parents[0].val=t:(this._value=t,this._jsType=l(this._value),this._updateChildren())}},c.prototype.setMatchingPattern=function(t){return f[t]?(this._matchPatternType=t,this._updateMatchPattern(),this._matchUpdate(),this._updateChildren(),!0):(s&&console.warn("X.js: unrecognized matching pattern type for XBASE.setMatchingPattern()"),!1)};var f={"longest-list":!0,"shortest-list":!0,"cross-reference":!0},h=function(t){c.call(this,t),this._type="XWRAP",this._isConstrained=!1};h.prototype=Object.create(c.prototype),h.prototype.constructor=h;var g=function(t){return new h(t)},p=function(t){c.call(this,t),this._type="XARRWRAP",this._isConstrained=!0,this._matchUpdate=function(){this._value="array"!==this._parents[0]._jsType?[this._parents[0]._value]:this._parents[0]._value}},d=function(){return u("XARRWRAP",arguments,"fromParent")};p._updates={fromParent:function(t){return t[0]}},e._wrapArr=function(t){return d(t)};var v=function(t){c.call(this,t),this._type="XVAR"};v.prototype=Object.create(c.prototype),v.prototype.constructor=v;var m=["not","half","double","abs","sqrt","sin","cos","tan","round","floor","ceil","toDegrees","toRadians","length","toLowerCase","toUpperCase"];m.forEach(function(t){v.prototype[t]=function(){return this._properties[t]!==void 0?this._properties[t]:this._register(t,u("XVAR",[this],t))}}),v.prototype.slice=function(t,n){return"string"!==this._jsType?(s&&console.warn("X.js: XVAR.slice() only works with string parents at the time"),void 0):0==arguments.length?u("XVAR",[this,0,this.length()],"slice"):1==arguments.length?u("XVAR",[this,t,this.length()],"slice"):2==arguments.length?u("XVAR",[this,t,n],"slice"):void 0},v.prototype.charAt=function(t){return"string"!==this._jsType?(s&&console.warn("X.js: XVAR.charAt() only works with string parents at the time"),void 0):1!=arguments.length?(s&&console.warn("X.js: Invalid arguments for XVAR.charAt()"),void 0):u("XVAR",[this,t],"charAt")},v.prototype.replace=function(t,n){return 2!=arguments.length?(s&&console.warn("X.js: Invalid arguments for XVAR.replace()"),void 0):u("XVAR",[this,t,n],"replace")},e.var=function(){return 1!=arguments.length?(s&&console.warn("X.js: Invalid arguments for X.var()"),void 0):u("XVAR",arguments,"fromValue")},e.boolean=e.bool=function(){return 1!=arguments.length?(s&&console.warn("X.js: Invalid arguments for X.boolean()"),void 0):u("XVAR",arguments,"boolean")},e.number=e.num=function(){return 1!=arguments.length?(s&&console.warn("X.js: Invalid arguments for X.number()"),void 0):u("XVAR",arguments,"number")},e.string=e.str=function(){return 1!=arguments.length?(s&&console.warn("X.js: Invalid arguments for X.string()"),void 0):u("XVAR",arguments,"string")},e.array=e.arr=function(){return 1!=arguments.length?(s&&console.warn("X.js: Invalid arguments for X.array()"),void 0):u("XVAR",arguments,"array")},e.and=function(){return 0==arguments.length?(s&&console.warn("X.js: Invalid arguments for X.and()"),void 0):u("XVAR",arguments,"and")},e.or=function(){return 0==arguments.length?(s&&console.warn("X.js: Invalid arguments for X.or()"),void 0):u("XVAR",arguments,"or")},e.equal=function(){return 2>arguments.length?(s&&console.warn("X.js: Must pass at least two arguments to X.equal()"),void 0):u("XVAR",arguments,"equal")},e.notEqual=e.different=function(){return 2>arguments.length?(s&&console.warn("X.js: Must pass at least two arguments to X.notEqual()"),void 0):u("XVAR",arguments,"notEqual")},e.greater=function(){return 2!=arguments.length?(s&&console.warn("X.js: Must pass exactly two arguments to X.greater()"),void 0):u("XVAR",arguments,"greater")},e.greaterEqual=function(){return 2!=arguments.length?(s&&console.warn("X.js: Must pass exactly two arguments to X.greaterEqual()"),void 0):u("XVAR",arguments,"greaterEqual")},e.less=function(){return 2!=arguments.length?(s&&console.warn("X.js: Must pass exactly two arguments to X.less()"),void 0):u("XVAR",arguments,"less")},e.lessEqual=function(){return 2!=arguments.length?(s&&console.warn("X.js: Must pass exactly two arguments to X.lessEqual()"),void 0):u("XVAR",arguments,"lessEqual")},e.add=function(){return 0==arguments.length?(s&&console.warn("X.js: Invalid arguments for X.add()"),void 0):u("XVAR",arguments,"add")},e.subtract=e.diff=function(){return 2!=arguments.length?(s&&console.log("X.js: Invalid arguments for X.subtract()"),void 0):u("XVAR",arguments,"subtract")},e.multiply=function(){return 2>arguments.length?(s&&console.log("X.js: Invalid arguments for X.multiply()"),void 0):u("XVAR",arguments,"multiply")},e.divide=function(){return 2!=arguments.length?(s&&console.log("X.js: Invalid arguments for X.divide()"),void 0):u("XVAR",arguments,"divide")},e.modulo=function(){return 2!=arguments.length?(s&&console.log("X.js: Invalid arguments for X.modulo()"),void 0):u("XVAR",arguments,"modulo")},e.pow=function(){return 2!=arguments.length?(s&&console.log("X.js: Invalid arguments for X.pow()"),void 0):u("XVAR",arguments,"pow")},e.atan2=function(){return 2!=arguments.length?(s&&console.log("X.js: Invalid arguments for X.atan2()"),void 0):u("XVAR",arguments,"atan2")},e.random=function(t,n){if(arguments.length>2)return s&&console.log("X.js: Invalid arguments for X.random()"),void 0;if(is(t).type("array")||is(n).type("array"))return s&&console.log("X.js: X.random() currently only accepts non-array arguments"),void 0;var r,e;n!==void 0?(r=t,e=n):(r=0,e=t!==void 0?t:1);var a=u("XVAR",[Math.random(),r,e],"random");return a.next=y,a};var y=function(){this._parents[0].val=Math.random()};e.compose=function(){var t=arguments,n=t.length;if(2>n)return s&&console.warn("X.js: invalid arguments for X.compose()"),void 0;var r=t[n-1];if(!is(r).type("function"))return s&&console.warn("X.js: last argument must be an update function for X.compose()"),void 0;for(var e=[],a=0;n-1>a;a++)e.push(t[a]);return u("XVAR",e,"compose",{_customUpdate:r})},e.series=function(){return 3!=arguments.length?(s&&console.log("X.js: Invalid arguments for X.series()"),void 0):u("XVAR",arguments,"series")},e.range=function(){return 3!=arguments.length?(s&&console.log("X.js: Invalid arguments for X.range()"),void 0):u("XVAR",arguments,"range")},e.concat=function(){return 0==arguments.length?(s&&console.log("X.js: Invalid arguments for X.concat()"),void 0):u("XVAR",arguments,"concat")},v._updates={fromValue:function(t){return t[0]},"boolean":function(t){return Boolean(t[0])},number:function(t){return Number(t[0])},string:function(t){return t[0]+""},array:function(t){return[t[0]]},not:function(t){return!t[0]},and:function(t){for(var n=0;t.length>n;n++)if(!t[n])return!1;return!0},or:function(t){for(var n=0;t.length>n;n++)if(t[n])return!0;return!1},equal:function(t){for(var n=t.length-1,r=0;n>r;r++)if(t[r]!=t[r+1])return!1;return!0},notEqual:function(t){for(var n=t.length,r=0;n-1>r;r++)for(var e=r+1;n>e;e++)if(t[r]==t[e])return!1;return!0},greater:function(t){return t[0]>t[1]},greaterEqual:function(t){return t[0]>=t[1]},less:function(t){return t[0]<t[1]},lessEqual:function(t){return t[0]<=t[1]},half:function(t){return.5*t[0]},"double":function(t){return 2*t[0]},abs:function(t){return Math.abs(t[0])},sqrt:function(t){return Math.sqrt(t[0])},sin:function(t){return Math.sin(t[0])},cos:function(t){return Math.cos(t[0])},tan:function(t){return Math.tan(t[0])},round:function(t){return Math.round(t[0])},floor:function(t){return Math.floor(t[0])},ceil:function(t){return Math.ceil(t[0])},toDegrees:function(t){return n*t[0]},toRadians:function(t){return r*t[0]},add:function(t){for(var n=t[0],r=1;t.length>r;r++)n+=t[r];return n},subtract:function(t){return t[0]-t[1]},multiply:function(t){for(var n=t[0],r=t.length,e=1;r>e;e++)n*=t[e];return n},divide:function(t){return t[0]/t[1]},modulo:function(t){return t[0]%t[1]},pow:function(t){return Math.pow(t[0],t[1])},atan2:function(t){return Math.atan2(t[0],t[1])},random:function(t){return t[0]*(t[2]-t[1])+t[1]},series:function(t){for(var n=[],r=0;t[0]>r;r++)n.push(t[1]+r*t[2]);return n},range:function(t){for(var n=[],r=(t[2]-t[1])/t[0],e=t[1];t[2]>=e;e+=r)n.push(e);return n},length:function(t){return t[0].length!==void 0?t[0].length:1},toLowerCase:function(t){return t[0].toLowerCase?t[0].toLowerCase():t[0]},toUpperCase:function(t){return t[0].toUpperCase?t[0].toUpperCase():t[0]},slice:function(t){return t[0].slice!==void 0?t[0].slice(t[1],t[2]):t[0]},charAt:function(t){return t[0].charAt!==void 0?t[0].charAt(t[1]):""},replace:function(t){return t[0].replace!==void 0?t[0].replace(t[1],t[2]):t[0]},concat:function(t){for(var n=t[0]+"",r=1;t.length>r;r++)n+=t[r];return n},compose:function(t){return this._customUpdate(t)}};var _={XWRAP:h,XVAR:v,XARRWRAP:p};e.tagVars=function(t){if(!t)return s&&console.log("X.js: Incorrect arguments for X.tagVars()"),!1;var n=!1;for(var r in t)has(t[r]).property("_xvar")&&(t[r]._name=r,n=!0);return n},e.injectVars=e.linkVars=function(t){if(!t)return s&&console.log("X.js: Incorrect arguments for X.injectVars()"),!1;this.tagVars(t);var n=!1;return a.forEach(function(r){if(""!==r._name){var e=r._name.toUpperCase();Object.defineProperty(t,e,{get:function(){return r._value},set:function(t){r.val=t}}),s&&console.info('X.js: Created "'+e+'" pointing to "'+r._name+'.val"'),n=!0}}),!0},"object"!=typeof exports||void 0===exports?window?window.X=e:console.log("X.js: No window object was found..."):module.exports=e})();